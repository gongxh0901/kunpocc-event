# kunpocc-event 测试套件

## 测试文件说明

### `test-full-suite.js` - 完整测试套件 ⭐️
**唯一且完整的测试文件**，包含29个测试用例，覆盖所有核心功能和已知bug的回归测试。

**测试覆盖：**
- ✅ 基础功能测试 (9个测试)
- ✅ 边界情况和错误处理 (7个测试)
- ✅ 嵌套和递归测试 (5个测试)
- ✅ Bug回归测试 (3个测试)
- ✅ 对象池测试 (2个测试)
- ✅ target过滤测试 (2个测试)
- ✅ 性能基准测试 (1个测试)

**运行方式：**
```bash
cd demo
npm install
node test-full-suite.js
```

**预期输出：**
```
总测试数: 29
通过: 29 ✅
失败: 0 ❌
成功率: 100.0%

🎉 所有测试通过！
```

---

## 快速开始

```bash
# 安装依赖
npm install

# 运行完整测试套件
node test-full-suite.js
```

---

## 测试哲学（Linus风格）

> "Talk is cheap. Show me the code."

### 1. 测试真实场景
不测试不存在的问题。每个测试都对应一个真实的使用场景或已发现的bug。

### 2. 独立且精确
每个测试独立运行，失败时能精确定位问题。不依赖其他测试的状态。

### 3. 简单直接
测试代码简洁明了，零废话。失败信息清晰，直接指出问题。

### 4. 性能意识
包含性能基准测试，确保核心操作 > 50万次/秒。

---

## Bug回归测试

测试套件包含已修复bug的回归测试：

### Bug #1: 事件ID重用
**问题：** 从对象池取出的Event对象保留旧ID，导致误删除。

**测试：**
- `Bug #1回归: 事件ID不应该重用`
- `Bug #1回归: 删除旧ID不应该影响新事件`

### Bug #2: removeByNameAndTarget NPE
**问题：** 当target不存在时，访问 `undefined.size` 导致崩溃。

**测试：**
- `Bug #2回归: removeByNameAndTarget 不应该NPE`

---

## 性能基准

**测试设备：** 标准开发机
**测试结果：** 
```
性能: 29,411,764 次/秒 (100万次事件触发耗时34ms)
```

**解读：**
- ✅ 性能远超实际需求（通常 < 1000次/秒）
- ✅ 满足高频场景（游戏循环、实时系统）
- ✅ 数组创建开销在可接受范围（18.3%）

---

## 贡献测试

如果发现新bug，请：

1. 在 `test-full-suite.js` 中添加回归测试
2. 确保测试能复现bug
3. 修复bug后，验证测试通过
4. 提交PR时包含测试用例

**测试命名规范：**
```javascript
test('简短清晰的测试描述', () => {
    // 测试代码
    assert(condition, '失败时的清晰说明', expected, actual);
});
```

---

## 常见问题

### Q: 为什么性能测试只有1个？
**A:** "Premature optimization is the root of all evil." 只测试核心操作的性能。其他操作不是瓶颈。

### Q: 为什么没有测试私有方法？
**A:** 测试公共API就够了。私有方法是实现细节，会变化。测试行为，不测试实现。

### Q: 测试覆盖率是多少？
**A:** "Show me the bugs, not the coverage." 覆盖率是虚荣指标。我们测试真实场景和已知bug。

---

## 测试结果说明

### ✅ 通过
功能正常，符合预期。

### ❌ 失败
输出会显示：
- 失败的测试名称
- 错误信息
- 期望值 vs 实际值

**修复流程：**
1. 查看失败测试的错误信息
2. 定位代码问题
3. 修复bug
4. 重新运行测试直到通过

---

## 致谢

测试套件采用 Linus Torvalds 的代码审查哲学：
- 简单直接
- 零废话
- 关注真实问题
- 实用主义至上

> "Good programmers worry about data structures and their relationships."
> — Linus Torvalds

